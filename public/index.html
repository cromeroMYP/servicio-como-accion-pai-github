<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Servicio como Acción - IB MYP</title>
  <!-- Bootstrap CDN for modern styling -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ENjdO4Dr2bkBIFxQpeoPhZJ5nFQElt8iLQF2BbiSp9Og4D+RczE9Nichjhih+4m9" crossorigin="anonymous">
  <style>
    body { background: #f0f4f8; }
    h1, h2 { color: #343a40; }
    .container { max-width: 800px; margin-top: 2rem; }
    #result { margin-top: 1rem; white-space: pre-wrap; background: #ffffff; padding: 1rem; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,.1); }
  </style>
</head>
<body>
  <div class="container bg-white p-4 rounded shadow-sm">
    <h1 class="mb-3">Servicio como Acción - Programa de los Años Intermedios (PAI)</h1>
    <p class="lead">Esta aplicación explica en detalle qué es el servicio como acción y ayuda a los profesores a diseñar actividades.</p>
    <h2 class="mt-4">¿Qué es el Servicio como Acción?</h2>
    <p>El servicio como acción es una parte integral del Programa de los Años Intermedios (PAI) del Bachillerato Internacional (IB). Busca desarrollar en los estudiantes una comprensión de la responsabilidad social y el compromiso con la comunidad mediante la realización de acciones de servicio con un propósito de aprendizaje.</p>
    <p>Tipos de servicio:</p>
    <ul>
      <li><strong>Directo:</strong> interacción inmediata con personas o el medio.</li>
      <li><strong>Indirecto:</strong> trabajo tras bambalinas en beneficio de otros.</li>
      <li><strong>Promoción de una causa:</strong> campañas o abogacía.</li>
      <li><strong>Investigación:</strong> estudio para comprender mejor una necesidad o problema social.</li>
    </ul>

    <h2 class="mt-4">Diseña tu propuesta de servicio</h2>
    <form id="proposal-form" class="row g-3">
      <div class="col-md-4">
        <label for="year" class="form-label">Año PAI (1-5)</label>
        <input type="number" class="form-control" id="year" name="year" min="1" max="5" required />
      </div>
      <div class="col-md-4">
        <label for="subject" class="form-label">Asignatura</label>
        <input type="text" class="form-control" id="subject" name="subject" required />
      </div>
      <div class="col-md-4">
        <label for="serviceType" class="form-label">Tipo de servicio</label>
        <select id="serviceType" class="form-select" name="serviceType" required>
          <option value="directo">Directo</option>
          <option value="indirecto">Indirecto</option>
          <option value="promocion de una causa">Promoción de una causa</option>
          <option value="investigacion">Investigación</option>
        </select>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary">Generar propuesta</button>
      </div>
    </form>

    <div id="result" class="mt-4"></div>
  </div>

  <script>
    // Shared form handling that works both when served and opened as file
    document.getElementById('proposal-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const year = document.getElementById('year').value;
      const subject = document.getElementById('subject').value;
      const serviceType = document.getElementById('serviceType').value;
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = 'Generando propuesta...';

      function localProposal(y, s, t) {
        return `Propuesta de ejemplo para año ${y}, asignatura ${s} y servicio ${t}.\n\n- Objetivo: fomentar la conciencia social.\n- Pasos: …\n- Recursos: …`;
      }

      // If running from file:// or the fetch fails, use the local proposal
      if (window.location.protocol === 'file:') {
        resultDiv.textContent = localProposal(year, subject, serviceType);
        return;
      }

      try {
        const resp = await fetch('/api/proposal', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ year, subject, serviceType })
        });
        if (!resp.ok) throw new Error('Network response was not ok');
        const data = await resp.json();
        if (data.error) {
          throw new Error(data.error);
        }
        resultDiv.textContent = data.proposal;
      } catch (err) {
        // fallback to local proposal if server not available
        resultDiv.textContent = localProposal(year, subject, serviceType);
      }
    });
  </script>
</body>
</html>
